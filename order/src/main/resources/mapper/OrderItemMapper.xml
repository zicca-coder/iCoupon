<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zicca.icoupon.order.dao.mapper.OrderItemMapper">

    <sql id="table">
        t_order_item
    </sql>

    <sql id="baseColumn">
        id
        ,
        order_id,
        user_id,
        goods_id,
        goods_name,
        price,
        original_price,
        quantity,
        subtotal_amount,
        pay_amount,
        discount_amount
    </sql>

    <sql id="column">
        <include refid="baseColumn"/>,
        create_time,
        update_time,
        create_by,
        update_by,
        del_flag
    </sql>

    <sql id="insertColumn">
        <include refid="column"/>
    </sql>

    <sql id="insertValues">
        #{orderItem.id}
        ,
        #{orderItem.orderId},
        #{orderItem.userId},
        #{orderItem.goodsId},
        #{orderItem.goodsName},
        #{orderItem.price},
        #{orderItem.originalPrice},
        #{orderItem.quantity},
        #{orderItem.subtotalAmount},
        #{orderItem.payAmount},
        #{orderItem.discountAmount},
        #{orderItem.createTime},
        #{orderItem.updateTime},
        #{orderItem.createBy},
        #{orderItem.updateBy},
        #{orderItem.delFlag}
    </sql>

    <select id="selectOrderItemById" resultType="com.zicca.icoupon.order.dao.entity.OrderItem" >
        SELECT
        <include refid="column"/>
        FROM
        <include refid="table"/>
        WHERE id = #{id}
        AND del_flag = 0
    </select>

    <select id="selectOrderItemByIdAndUserId" resultType="com.zicca.icoupon.order.dao.entity.OrderItem" >
        SELECT
        <include refid="column"/>
        FROM
        <include refid="table"/>
        WHERE id = #{id}
        AND user_id = #{userId}
        AND del_flag = 0
    </select>

    <select id="selectOrderItemListByIds" resultType="com.zicca.icoupon.order.dao.entity.OrderItem" >
        SELECT
        <include refid="column"/>
        FROM
        <include refid="table"/>
        WHERE id
        IN
        <foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND del_flag = 0
    </select>

    <select id="selectOrderItemListByIdsAndUserId" resultType="com.zicca.icoupon.order.dao.entity.OrderItem" >
        SELECT
        <include refid="column"/>
        FROM
        <include refid="table"/>
        WHERE id
        IN
        <foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND user_id = #{userId}
        AND del_flag = 0
    </select>

    <insert id="insertOrderItem">
        INSERT INTO
        <include refid="table"/>
        (
        <include refid="insertColumn"/>
        ) VALUES (
        <include refid="insertValues"/>
        )
    </insert>

    <insert id="batchInsertOrderItem">
        INSERT INTO
        <include refid="table"/>
        (
        <include refid="insertColumn"/>
        )
        VALUES
        <foreach item="orderItem" index="index" collection="orderItemList" separator=",">
            (
            <include refid="insertValues"/>
            )
        </foreach>
    </insert>


    <delete id="deleteOrderItem" >
        DELETE
        FROM
        <include refid="table"/>
        WHERE id = #{id}
        AND del_flag = 0
    </delete>

    <delete id="deleteOrderItemByIdAndUserId">
        DELETE
        FROM
        <include refid="table"/>
        WHERE id = #{id}
        AND user_id = #{userId}
        AND del_flag = 0
    </delete>

    <delete id="batchDeleteOrderItem">
        DELETE
        FROM
        <include refid="table"/>
        WHERE id
        IN
        <foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND del_flag = 0
    </delete>

    <delete id="batchDeleteOrderItemByIdsAndUserId">
        DELETE
        FROM
        <include refid="table"/>
        WHERE id
        IN
        <foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND user_id = #{userId}
        AND del_flag = 0
    </delete>


</mapper>